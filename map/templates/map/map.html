<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    {% if DEBUG %}
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.js"
                integrity="sha256-nd3JLOQlNGixlXNjD4rPEwBNtIXCcsPW7jQW2C8HM/w=" crossorigin="anonymous"></script>
    {% else %}
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"
                integrity="sha256-WVsM3xrcqyuFNF3W1qtIKbHFsD0977nDQA8DCMp1zCw=" crossorigin="anonymous"></script>
    {% endif %}
    <script src="https://unpkg.com/mappa-mundi@0.0.5/dist/mappa.js" type="text/javascript"></script>
    <style>
        html, body {
            padding: 0;
            margin: 0;
        }
    </style>
</head>
<body>
<input id="data" hidden value="{{ sheep }}"/>
<script>
  let map;
  let canvas;
  const mappa = new Mappa('Leaflet');
  const dataField = document.getElementById("data");
  const data = JSON.parse(dataField.value);

  const sheep = data.map(pos => ({
    y: pos.lastKnownLng,
    x: pos.lastKnownLat
  }));

  const options = {
    lat: 51.054452,
    lng: 3.7143995,
    zoom: 14,
    style: "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
  };

  function setup() {
    canvas = createCanvas(windowWidth, windowHeight);
    map = mappa.tileMap(options);
    map.overlay(canvas);
    map.onChange(drawSheep);
  }

  function draw() {
  }

  function windowResized() {
    canvas = createCanvas(windowWidth, windowHeight);
    map = mappa.tileMap(options);
    map.overlay(canvas);
    map.onChange(drawSheep);
  }

  function drawSheep() {
    clear();

    sheep.forEach(sh => {
      const pixelPos = map.latLngToPixel(sh.x, sh.y);
      ellipse(pixelPos.x, pixelPos.y, 20, 20);
    })
  }
</script>
</body>
</html>